version: "3.7"
services:
  # Create the api first
  clembot.api:
    restart: always
    image: ghcr.io/clembotproject/clembot.api:master
    networks:
        - ClemBotNet
    env_file: 
        - ClemBot.Api/ClemBot.Api_env.env
        
  # Create the python eval container for sandboxed python code execution
  snekbox:
    image: ghcr.io/python-discord/snekbox:latest
    init: true
    ipc: none
    networks: 
      - ClemBotNet
    privileged: true
    
  # Create the Bot process to server as the dapi frontend
  clembot.bot:
    image: ghcr.io/clembotproject/clembot.bot:master
    restart: always
    user: root
    depends_on: 
      - clembot.api
    networks: 
      - ClemBotNet
    env_file: 
      - ClemBot.Bot/ClemBot.Bot_env.env
    volumes:
      - ~/Logs:/ClemBot.Bot/Logs
    
  # Create the Site process to serve user requests
  clembot.site:
    image: ghcr.io/clembotproject/clembot.site:master
    restart: always
    depends_on: 
      - clembot.api
    networks: 
      - ClemBotNet
    env_file: 
      - ClemBot.Site/ClemBot.Site_env.env

networks:
  ClemBotNet: